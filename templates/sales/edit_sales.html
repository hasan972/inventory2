[[extend 'layout3.html']]

[[block header]]
<style>
    .custom-radio {
    width: 15px;
    height: 15px;
    }
        li{
        list-style: none;
        cursor: pointer;
    }
    ul.suggestion-list-cd,ul.suggestion-list-nm,ul.suggestion-list-rf{
        list-style-type: none;
        margin: 0;
        padding: 0;
        
        }

    .suggestions-cd,.suggestions-nm,.suggestions-rf{
        display: block; 
        background: #eee;
        position: absolute;               
        z-index: 1000;    
        
    }

    .scrollable-table {
    max-height: 300px;
    overflow-y: auto;
    position: relative;
    z-index: 1;
}

.table th{
    background-color: #a8b2bc;
    color: black;
    font-weight: bold;
    position: sticky;
    top: 0;
}
.table tfoot {    
    color: black;
    font-weight: bold;
    position: sticky;
    bottom:-1;
    
}
.table tbody tr:nth-of-type(even){
    background-color: #f3f6f8;
}
.custom-max-width {
  max-width: 80%; /* Adjust the value as needed */
  margin: 0 auto; /* Center the container */
}
.numb {
    text-align: right;
    padding-right: 40px;
}

</style>

[[icon='fa fa-chart-line']]

[[breadcamp = 'Edit Sales']]
[[icon2='fa-solid fa-plus']]
[[breadcamp2 = 'Sales List']]

[[end]]





[[block content]]

<div class="container py-1">
    <div class="text-end mt-2">
        <a href="[[=URL('sales','new_sales',receive_branch_code,receive_branch_name)]]" >
            <i class="fa-solid fa-plus"></i> New
        </a>
    </div>
    <div class="card shadow-sm mb-0">
        <div class="card-body">
            <div class="row">
                <!-- Left Column -->
                <div class="col-md-6">
                    <div class="mb-2">
                        <strong>Transaction Type:</strong>
                        <span id="supplier" class="">[[=trans_type]]</span>
                    </div>
                    <div class="mb-2">
                        <strong>Sales Date:</strong>
                        <span id="receive_date" class="ms-2">[[ = trans_date]]</span>
                    </div>
                    <div class="mb-2">
                        <strong>Description:</strong>
                        [[ if editable: ]]
                            <input type="text" id="description" class="form-control-md" style="width: 70%;" value="[[ = description ]]" >
                        [[ else: ]]
                            <span id="description" class="form-control-md" style="width: 70%;">[[ = description ]]</span>
                        [[ pass ]]
                    </div>
                </div>

                <!-- Right Column -->
                <div class="col-md-6">
                    <div class="mb-2">
                        <strong>Sales No:</strong>
                        <span id="sl" class="ms-2">[[ = trans_code]]</span>
                    </div>
                    <div class="mb-2">
                        <strong>Status:</strong>
                        [[if status == 'POSTED':]]
                        <span id="status" class="badge bg-success ms-2">[[ = status]]</span>
                        [[elif status == 'DRAFT':]]
                        <span id="status" class="badge bg-danger ms-2">[[ = status]]</span>
                        [[elif status == 'CANCEL':]]
                        <span id="status" class="badge bg-secondary ms-2">[[ = status]]</span>
                        [[else:]]
                        <span id="status" class="badge bg-info ms-2">[[ = status]]</span>
                        [[pass]]
                    </div>   
                    <div class="mb-2">
                        <strong>Branch:</strong>
                        <span id="vbn" class="ms-2">[[ = receive_branch_name]]</span>
                        <span id="vbc" style="display: none;" class="ms-2">[[ = receive_branch_code]]</span>
                    </div>   
                                     
                </div>
            </div>
        </div>
    </div>
</div>




<div class="container-section">
    [[if editable: ]]
    <div class="container py-2">
        <div class="card shadow-sm">
            <form action="">
                <div class="card-body">
                <div id="custom_input">
                    <div class="row g-3">

                        <!-- Quantity -->
                        <div class="col-md-1">
                            <label for="qty" class="form-label">Quantity<span class="text-danger">*</span></label>
                            <input type="number" class="form-control form-control-sm" id="qty" name="qty" value="1.0" min="0" max="10000000">
                        </div>

                        <!-- barcode  -->
                        <div class="col-md-2">
                            <label for="item_code" class="form-label">Barcode<span class="text-danger"></span></label>
                            <input type="text" class="form-control form-control-sm" id="barcode" name="barcode" autocomplete="off">
                            
                        </div>
                        <!-- Item Code -->
                        <div class="col-md-2">
                            <label for="item_code" class="form-label">Item Code<span class="text-danger">*</span></label>
                            <input type="text" class="form-control form-control-sm" id="item_code" name="item_code" autocomplete="off">
                            <div class="suggestions-cd mt-2">
                                <ul class="suggestion-list-cd list-group" id="dropdata-cd">
                                    <!-- suggestions will be displayed here -->
                                </ul>
                            </div>
                        </div>
    
                        <!-- Item Name -->
                        <div class="col-md-3">
                            <label for="item_name" class="form-label">Item Name<span class="text-danger">*</span></label>
                            <input type="text" class="form-control form-control-sm" id="item_name" name="item_name" autocomplete="off" readonly="true">
                            <div class="suggestions-nm mt-2">
                                <ul class="suggestion-list-nm list-group" id="dropdata-nm">
                                    <!-- suggestions will be displayed here -->
                                </ul>
                            </div>
                        </div>                       
    
                        <!-- Add Row Button -->
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary btn-sm w-100" data-bs-toggle="tooltip" data-placement="bottom" title="Add item" id="add-row">
                                <i class="fas fa-plus"></i> Add Item
                            </button>
                        </div>                       
                                          
                    </div>
                    
                    
                </div>
            </div>
            </form>
            
        </div>
    </div>
    [[pass]]

    <!-- Modal  -->

    
    
    <div class="container py-2" >
        <div class="row">
            <div class="col-12">
                <div class="scrollable-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">Item Code</th>
                                <th scope="col">Item Name</th>
                                <th class="numb" scope="col">Qty</th>                                 
                                <th class="numb" scope="col">Price</th>                                 
                                <th class="numb" scope="col">Total</th>                                 
                                
                                [[if editable: ]]
                                <th scope="col">Remove</th>
                                [[pass]]
                            </tr>
                        </thead>                        
                        <tbody id="tbody">
                            [[for row in rows:]]
                            <tr>
                                <td>[[=row['item_code']]]</td>
                                <td>[[=row['item_name']]]</td>
                                <td class="numb">[[=row['quantity']]]</td>  
                                <td class="numb">[[=row['trade_price']]]</td>  
                                <td class="numb">[[=row['total']]]</td>  
                               
                                [[if editable: ]]
                                <td><button type='button' class='btn btn-outline-danger remove-row'><i class='fa-solid fa-x'></i></button></td>
                                [[pass]]
                            </tr>
                            [[pass]]
                        </tbody>
                        <tfoot>
                            <tr class="tft">
                                <td id="emp"  style="font-weight: bold;"></td>
                                <td id="emp"  style="font-weight: bold;"></td>
                                <td id="emp"  style="font-weight: bold;"></td>
                                <td class="numb" id="tot" style="font-weight: bold;">Sub Total</td>
                                <td class="numb" id="total-amt" style="font-weight: bold;">0</td>
                            </tr>
                            <tr class="tft">
                                <td id="emp"  style="font-weight: bold;"></td>
                                <td id="emp"  style="font-weight: bold;"></td>
                                <td id="emp"  style="font-weight: bold;"></td>
                                <td class="numb" id="tot" style="font-weight: bold;">Vat</td>
                                <td class="numb" id="vat-amt" style="font-weight: bold;">0</td>
                            </tr>
                            <tr class="tft">
                                <td id="emp"  style="font-weight: bold;"></td>
                                <td id="emp"  style="font-weight: bold;"></td>
                                <td id="emp"  style="font-weight: bold;"></td>
                                <td class="numb" id="tot" style="font-weight: bold;">Total</td>
                                <td class="numb" id="grand-total" style="font-weight: bold;">0</td>
                            </tr>
                        </tfoot>
                    </table>

                </div>
                
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-11">
                [[if editable: ]]
                    <!-- <button type="button" class="btn btn-success me-2" data-toggle="tooltip" data-placement="bottom" title="Save Voucher" id="save-data">Save</button> -->
                    <button type="button" class="btn btn-primary me-2" data-toggle="tooltip" data-placement="bottom" title="Post Voucher" id="post-data">Sell</button>
                    <input type="checkbox" id="post-checkbox" name="post-checkbox" data-toggle="tooltip" data-placement="bottom" title="Post">
                    <label for="post-checkbox" class="ms-1">Confirm Sales</label>
                [[pass]]
            </div>
            <div class="col-1 d-flex justify-content-end">
                <!-- <button type="button" class="btn btn-secondary me-2" data-toggle="tooltip" data-placement="bottom" title="Preview" id="preview-data"><i class="fa-regular fa-eye"></i></button> -->
                <button type="button" class="btn btn-secondary me-2" data-toggle="tooltip" data-placement="bottom" title="Print Voucher" id="print-data"><i class="fa-solid fa-print"></i></button>                
                [[if editable: ]]
                    <button type="button" style='padding-left: 30px;' class="btn btn-danger me-2" data-toggle="tooltip" data-placement="bottom" title="Cancel Voucher" id="cancel-data">Cancel</button>
                [[pass]]
            </div>
        </div>
    </div>
</div>
[[end]] 






[[block scripts]]
<script>
    $(document).ready(function () {

        $("form").on("submit", function(e) {
            e.preventDefault();
        });
        
        function formatNumberWithCommas(number) {
            return number.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

        }   

        // function to calculate total debit and total credit 
        function updateTotals() {
            let total = 0;
            let vat = 0;
            let grand_total = 0;

            $("#tbody tr").each(function () {
                total += parseFloat($(this).find("td:eq(4)").text().replace(/,/g, '')) || 0;
            });
            // console.log(formatNumberWithCommas(totalDebit.toFixed(2)))
            // console.log(formatNumberWithCommas(totalCredit.toFixed(2)))

            vat = parseFloat(((0.15*total).toFixed(2)));
            grand_total = total+vat;

            $("#total-amt").text(formatNumberWithCommas(total));
            $("#vat-amt").text(formatNumberWithCommas(vat));
            $("#grand-total").text(formatNumberWithCommas(grand_total));


        }

       
        //////////////
        updateTotals();

        // autofill suggestion for item 
        $('#item_code').on('input', function() {        
            var v_branch_code  = $("#vbc").text();
            var query = $(this).val();            
            if (query.length >= 3) {
                $.ajax({
                    url: '[[=URL("receive","fetch_item_code_name")]]',
                    data: {term: query},
                    success: function(data) {
                        var suggestions = JSON.parse(data);
                        var dropdown = $('#dropdata-cd');
                        dropdown.empty(); 
                        $.each(suggestions, function(index, value) {
                            dropdown.append('<li class="list-group-item suggestion-item">' + value + '</li>');
                        });
                        $('.suggestions-cd').show();
                    }
                });
            } else {
                $('.suggestions-cd').hide(); 
            }
    });

    //click on a suggestion
    $(document).on('click', '.suggestion-item', function() {
        var selectedText = $(this).text();
        var parts = selectedText.split('|');        
        $('#item_code').val(parts[0]); 
        $('#item_name').val(parts[1]); 
        $('.suggestions-cd').hide();
        
    });
    // click outside
    $(document).click(function(e) {
        if (!$(e.target).closest('.suggestions-cd, #item_code').length) {
            $('.suggestions-cd').hide();
        }
    });   

    
            
        //////////////////////////new add row/////////////////////////////////////////////////
           $("#add-row").click(function () {            
            var item_code = $("#item_code").val();
            var item_name = $("#item_name").val();
            var barcode = $("#barcode").val() || "";

            var qty = $("#qty").val();
            var receive_date = $("#receive_date").text();   
            var sl = $("#sl").text();    
            var receive_branch_code  = $("#vbc").text();  
            var receive_branch_name  = $("#vbn").text();  


            
            if (qty <= 0) { 
                Swal.fire({
                    title: "Invalid Quantity",
                    text: "Quantity must be greater than zero",
                    icon: "error"
                    });
                    return;
            } 
            if (qty >10000) {
                // alert("Amount must be greater than zero.");
                // return; 
                Swal.fire({
                    title: "Invalid Quantity",
                    text: "Maximum quantity 10,000",
                    icon: "error"
                    });
                    return;
            } 
            

            
            var itemExists = false;            

            var obj={
                sl:sl,
                item_code:item_code,
                item_name :item_name, 
                receive_date:receive_date,
                sl:sl, 
                qty:qty,
                v_branch_code:receive_branch_code,
                v_branch_name:receive_branch_name,
                barcode: barcode
            }  
            

    
            // if (itemExists) {
            //     Swal.fire({
            //         title: "Duplicate Entry",
            //         text: "Item already exists !",
            //         icon: "error"
            //         });
                
            // } else if (item_code && item_name) {

                $.ajax({
                    url: "[[=URL('sales','add_item')]]",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(obj),
                    success: function (response) {
                        var result = JSON.parse(response);
                        // console.log(result.status)
                        if (result.status === 'valid') {
                            total_amt= result.total;
                            trade_price=result.trade_price;
                            retail_price=result.retail_price;                            
                            itm_code=result.itm_code;
                            itm_name=result.itm_name;

                            // console.log("code-> "+itm_code)
                            // console.log("name-> "+itm_name)
                            var newRow = "<tr><td>" + itm_code + "</td><td>" + itm_name + "</td><td class='numb'>" + formatNumberWithCommas(qty)  + "</td><td class='numb'>" + formatNumberWithCommas(retail_price)  + "</td> <td class='numb'>"+formatNumberWithCommas(total_amt) +"</td> <td> <button type='button' style='padding-left: 30px;' class='btn btn-outline-danger remove-row' ><i class='fa-solid fa-x'></i>  </button></td></tr>";
                            // console.log(newRow)
                            $("#tbody").append(newRow);                           

                            $('#barcode').val("");
                            $('#item_code').val("");
                            $('#item_name').val("");
                            $('#qty').val("1.0");
                            $("#barcode").focus();
                            updateTotals();
                        }else if (result.status === 'not_found') {
                            // alert("Account not found for the user");
                            Swal.fire({
                                title: "Invalid Item",
                                text: "Item not found",
                                icon: "error"
                                });
                        }
                        else if (result.status === 'duplicate') {
                            $("#tbody tr").each(function () {
                                var rowItemCode = $(this).find("td:eq(0)").text(); // first cell = item_code
                                if (rowItemCode === result.itm_code) {
                                    $(this).find("td:eq(2)").text(formatNumberWithCommas(result.new_qty));  // Qty column
                                    $(this).find("td:eq(4)").text(formatNumberWithCommas(result.new_total)); // Total column
                                }
                            });

                            $('#barcode').val("");
                            $('#item_code').val("");
                            $('#item_name').val("");
                            $('#qty').val("1.0");
                            $("#barcode").focus();
                            updateTotals();
                        }
                        else if (result.status === 'exception') {
                            Swal.fire({
                                title: "Error",
                                text: result.message,
                                icon: "error"
                                });
                        }
                        else {
                                // alert("error");
                                Swal.fire({
                                    title: "Error",
                                    text: "Error adding account",
                                    icon: "error"
                                    });
                            }
                    }
                });
        }
    );
   

    //    Remove row
        $(document).on('click', '.remove-row', function () {
            var row = $(this).closest('tr');
            var item_code = row.find('td:eq(0)').text();             

            var sl = $("#sl").text();

            $.ajax({
                url: "[[=URL('receive','delete_receive_detail')]]",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ item_code: item_code,
                                        sl:sl
                            }),
                success: function (response) {
                    if (response.status === 'success') {                        
                        row.remove();
                        updateTotals()
                    }
                    else if(response.status === 'exception') {
                            Swal.fire({
                                    title: "Error",
                                    text: response.message,
                                    icon: "error"
                                    });
                        } 
                    else {
                        Swal.fire({
                                title: "Error",
                                text: "Error: " + response.message,
                                icon: "error"
                                });
                    }
                },
                error: function () {
                    Swal.fire({
                                title: "Error",
                                text: "An error occurred while trying to remove the row.",
                                icon: "error"
                                });
                }
            });      
           
        });


        // save button new
        $("#save-data").click(function () {
            
            var narration = $('#narration').val();
            var sl = $("#sl").text();         
            
            // var isPostChecked = $('#post-checkbox').is(':checked');

            var totalDebit = parseFloat($('#total-debit').text().replace(/,/g, ''));
            var totalCredit = parseFloat($('#total-credit').text().replace(/,/g, ''));

        //     if (isPostChecked && totalDebit !== totalCredit) {
        //                 Swal.fire({
        //                         title: "Invalid Total",
        //                         text: "Total debited amount must equal total credited amount.",
        //                         icon: "error"
        //                         });            
        //     return;
        // }
        
                $.ajax({
                    type: 'POST',
                    url: '[[=URL("save_voucher")]]',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        narration: narration,                        
                        sl:sl,
                        total: totalDebit
                    }),
                    success: function(data) {
                        if (data.success) {                            
                                Swal.fire({
                                title: "Saved",
                                text: "Voucher saved successfully",
                                icon: "success"
                                    }).then(() => {
                                    location.reload();
                                });

                        } else {
                            // Handle error
                            // alert('Failed to save data: ' + data.error);
                            Swal.fire({
                                title: "Error",
                                text: 'Failed to save data: ' + data.error,
                                icon: "error"
                                });
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error:', error);
                    }

            }
        );


    });


//     // post button ---> old
//     $("#post-data").click(function () {
        
//         var sl = $("#sl").text();         
//         var description = $("#description").val();         
//         var branch_code  = $("#vbc").text();         
//         var receive_date  = $("#receive_date").text();         
        
//         var isPostChecked = $('#post-checkbox').is(':checked');

//         if(isPostChecked) {
//             var sub_total = parseFloat($('#total-amt').text().replace(/,/g, ''));
//             var vat = parseFloat($('#vat-amt').text().replace(/,/g, ''));
//             var grand_total = parseFloat($('#grand-total').text().replace(/,/g, ''));

            

//         //     if (isPostChecked && totalDebit !== totalCredit) {
//         //                 Swal.fire({
//         //                         title: "Invalid Total",
//         //                         text: "Total debited amount must equal total credited amount.",
//         //                         icon: "error"
//         //                         });            
//         //                 return;
//         // }

//         $(this).prop('disabled', true);

//         $.ajax({
//             type: 'POST',
//             url: '[[=URL("sales","post_sales")]]',
//             contentType: 'application/json',
//             data: JSON.stringify({
//                 post: isPostChecked,                 
//                 sl:sl,
//                 sub_total: sub_total,
//                 vat: vat,
//                 grand_total:grand_total,
//                 branch_code: branch_code,
//                 description:description,
//                 receive_date:receive_date
//             }),
//             success: function(data) {
//                 if (data.success) {                            
//                         Swal.fire({
//                         title: "POSTED",
//                         text: "Sales posted successfully",
//                         icon: "success"
//                             }).then(() => {
//                             location.reload();
//                         });

//                 } else {
//                     if (data.error == "Sales already posted or cancelled") {
//                         Swal.fire({
//                             title: "Error",
//                             text: data.error,
//                             icon: "warning"
//                         }).then(() => {
//                             location.reload(); // Reload the page
//                         });
//                     } else {
//                         // Handle other errors
//                         Swal.fire({
//                             title: "Error",
//                             text: 'Failed to post data: ' + data.error,
//                             icon: "error"
//                         });
//                         $("#post-data").prop('disabled', false);
//                     }
//                 }
//             },
//             error: function(xhr, status, error) 
//             {
//                 console.error('Error:', error);
//                 $("#post-data").prop('disabled', false);
//             }

//         });

            
//     }       


// });

// post button with print 
$("#post-data").click(function () {
    var sl = $("#sl").text();         
    var description = $("#description").val();         
    var branch_code  = $("#vbc").text();         
    var receive_date  = $("#receive_date").text();         
    
    var isPostChecked = $('#post-checkbox').is(':checked');

    if (isPostChecked) {
        var sub_total = parseFloat($('#total-amt').text().replace(/,/g, ''));
        var vat = parseFloat($('#vat-amt').text().replace(/,/g, ''));
        var grand_total = parseFloat($('#grand-total').text().replace(/,/g, ''));

        $(this).prop('disabled', true);

        // First AJAX: Post the sales
        $.ajax({
            type: 'POST',
            url: '[[=URL("sales","post_sales")]]',
            contentType: 'application/json',
            data: JSON.stringify({
                post: isPostChecked,                 
                sl: sl,
                sub_total: sub_total,
                vat: vat,
                grand_total: grand_total,
                branch_code: branch_code,
                description: description,
                receive_date: receive_date
            }),
            success: function (data) {
                if (data.success) {
                    // âœ… Now call print_receipt after post is successful
                    $.ajax({
                        type: 'POST',
                        url: '[[=URL("sales","print_receipt")]]',
                        data: { trx_code: sl }, // Sending sales number
                        success: function (printData) {
                            try {
                                var parsed = JSON.parse(printData);
                                if (parsed.status === "success") {
                                    Swal.fire({
                                        title: "POSTED & PRINTED",
                                        text: "Sales posted and receipt printed successfully",
                                        icon: "success"
                                    }).then(() => {
                                        location.reload();
                                    });
                                } else {
                                    Swal.fire({
                                        title: "POSTED",
                                        text: "Sales posted successfully, but printing failed: " + parsed.message,
                                        icon: "warning"
                                    }).then(() => {
                                        location.reload();
                                    });
                                }
                            } catch (e) {
                                Swal.fire({
                                    title: "POSTED",
                                    text: "Sales posted successfully, but printing response was invalid",
                                    icon: "warning"
                                }).then(() => {
                                    location.reload();
                                });
                            }
                        },
                        error: function (xhr, status, error) {
                            Swal.fire({
                                title: "POSTED",
                                text: "Sales posted successfully, but failed to print",
                                icon: "warning"
                            }).then(() => {
                                location.reload();
                            });
                        }
                    });

                } else {
                    if (data.error == "Sales already posted or cancelled") {
                        Swal.fire({
                            title: "Error",
                            text: data.error,
                            icon: "warning"
                        }).then(() => {
                            location.reload();
                        });
                    } else {
                        Swal.fire({
                            title: "Error",
                            text: 'Failed to post data: ' + data.error,
                            icon: "error"
                        });
                        $("#post-data").prop('disabled', false);
                    }
                }
            },
            error: function (xhr, status, error) {
                console.error('Error:', error);
                $("#post-data").prop('disabled', false);
            }
        });
    }
});

        // cancel button
    $("#cancel-data").click(function () {
        var sl = $("#sl").text();

        console.log(sl)

    // SweetAlert confirmation dialog
    Swal.fire({
        title: 'Cancel?',
        text: "Do you really want to cancel the voucher?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes',
        cancelButtonText: 'No'
    }).then((result) => {
        if (result.isConfirmed) {
            // User clicked 'Yes'
            $.ajax({
                url: '[[=URL("receive","cancel_receive")]]',
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ sl: sl }),
                success: function (response) {
                    Swal.fire({
                        title: "Cancelled",
                        text: 'Receive cancelled successfully',
                        icon: "success"
                    }).then(() => {
                        location.reload();
                    });
                },
                error: function (xhr, status, error) {
                    Swal.fire({
                        title: "Error",
                        text: "An error occurred while cancelling the receive.",
                        icon: "error"
                    });
                }
            });
        } else {
            // User clicked 'No', do nothing
            console.log("Voucher cancellation aborted by user.");
        }
    });
});        
        


        // print button 
        $("#print-data").click(function() {
            var salesNo = $("#sl").text().trim();  // Get sales number from label
            
            if (salesNo) {
                $.ajax({
                    url: "[[=URL('sales','print_receipt')]]",
                    type: "POST",
                    data: { trx_code: salesNo },
                    success: function(response) {
                        alert("Receipt sent to printer!");
                    },
                    error: function(xhr, status, error) {
                        alert("Failed to print receipt.");
                        console.error(error);
                    }
                });
            } else {
                alert("Sales number not found.");
            }
        });
        
        // previeww button 
        $("#preview-data").click(function() {
            var sl = $("#sl").text();
            var status = $("#status").text();
            console.log(sl);
            console.log(status);            
            window.open('[[=URL("vouchers","preview_voucher",sl)]]');
                
        });

        // double click on table row- remove the line and fill form
    //     $(document).on('dblclick', '#tbody tr', function() {
    //         var status = $("#status").text();
    //         if(status=="DRAFT"){
    //             var accountCode = $(this).find('td:eq(0)').text();
    //             var accountName = $(this).find('td:eq(1)').text();
    //             var debit = parseFloat($(this).find("td:eq(2)").text().replace(/,/g, ''))
    //             var credit = parseFloat($(this).find("td:eq(3)").text().replace(/,/g, ''))
    //             var row = $(this);
    //             var sl = $("#sl").text();
    //             $.ajax({
    //                 url: "[[=URL('vouchers','delete_voucher_detail')]]",
    //                 type: "POST",
    //                 contentType: "application/json",
    //                 data: JSON.stringify({ account_code: accountCode,
    //                                         sl:sl                                        
    //                             }),
    //                             success: function (response) {
    //                                 if (response.status === 'success') {                        
    //                                     row.remove();
    //                                     updateTotals();

    //                                     $('#account_code').val(accountCode);
    //                                     $('#account_name').val(accountName);
    //                                     $('#amount').val(debit > 0 ? debit : credit);

    //                                     if (debit > 0) {
    //                                         $('#inlineRadio1').prop('checked', true);
    //                                     } else {
    //                                         $('#inlineRadio2').prop('checked', true);
    //                                     }
    //                                 } else {
    //                                     // alert("Error: " + response.message);
    //                                     Swal.fire({
    //                                             title: "Error",
    //                                             text: "Error: " + response.message,
    //                                             icon: "error"
    //                                             });
    //                                 }
    //                             },
    //                                 error: function () {
    //                                     // alert("An error occurred while trying to remove the row.");
    //                                     Swal.fire({
    //                                                 title: "Error",
    //                                                 text: "An error occurred while trying to remove the row.",
    //                                                 icon: "error"
    //                                                 });
    //                                 }
    //                             });   
                    
    //             }

    //   });

});
</script>

[[end]]

