[[extend 'layout3.html']]

[[block header]]
<style>
    .branch_code{
        display: none;
    }
</style>
[[icon='fa fa-chart-line']]
[[breadcamp = 'New User']]
[[end]]

[[block content]]

<div class="container-section">
 
    <div class="container py-4">
        [[= form.custom.begin ]]
        <div id="custom_input">
            <div class="row g-3">
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="username" class="form-label">User Name</label>
                        [[= form.custom.widgets['username'] ]]
                        [[ if 'username' in form.errors: ]]
                        <div class="text-danger">[[=form.errors['username']]]</div>
                        [[pass]]
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="first_name" class="form-label">First Name</label>
                        [[= form.custom.widgets['first_name'] ]]
                        [[ if 'first_name' in form.errors: ]]
                        <div class="text-danger">[[=form.errors['first_name']]]</div>
                        [[pass]]
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="last_name" class="form-label">Last Name</label>
                        [[= form.custom.widgets['last_name'] ]]
                        [[ if 'last_name' in form.errors: ]]
                        <div class="text-danger">[[=form.errors['last_name']]]</div>
                        [[pass]]
                    </div>
                </div>                
            </div>
            <div class="row g-3">
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        [[= form.custom.widgets['password'] ]]
                        [[ if 'password' in form.errors: ]]
                        <div class="text-danger">[[=form.errors['password']]]</div>
                        [[pass]]
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        [[= form.custom.widgets['email'] ]]
                        [[ if 'email' in form.errors: ]]
                        <div class="text-danger">[[=form.errors['email']]]</div>
                        [[pass]]
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="status" class="form-label">Status</label>
                        [[= form.custom.widgets['status'] ]]
                        [[ if 'status' in form.errors: ]]
                        <div class="text-danger">[[=form.errors['status']]]</div>
                        [[pass]]
                    </div>
                </div>             
            </div>
            <div class="row g-3">
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="branch_name" class="form-label">Select Branch</label>
                        [[= form.custom.widgets['branch_name'] ]]
                        [[ if 'branch_name' in form.errors: ]]
                        <div class="text-danger">[[=form.errors['branch_name']]]</div>
                        [[pass]]
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="role" class="form-label">Role</label>
                        [[= form.custom.widgets['role'] ]]
                        [[ if 'role' in form.errors: ]]
                        <div class="text-danger">[[=form.errors['role']]]</div>
                        [[pass]]
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="role" class="form-label">Mobile #</label>
                        [[= form.custom.widgets['contact'] ]]
                        [[ if 'contact' in form.errors: ]]
                        <div class="text-danger">[[=form.errors['contact']]]</div>
                        [[pass]]
                    </div>
                </div>
                <div class="branch_code">
                    <div class="mb-3">                            
                        [[= form.custom.widgets['branch_code'] ]]
                        [[ if 'branch_code' in form.errors: ]]
                        <div class="text-danger">[[=form.errors['branch_code']]]</div>
                        [[pass]]
                    </div>
                </div>                
                
            </div>
            <div class="row g-3">
                
                <div class="col-md-9 d-flex justify-content-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="fa-solid fa-save"></i> <span class="ms-2">Save</span>
                    </button>
                </div>
            </div>

            
        </div>
        [[= form.custom.end ]]
    </div>
    
    
    <!-- Search and Table Section -->

    <div class="container py-2">
        <form action="[[=URL('users','users')]]" method="GET">
            <label for="search_by">Search By:</label>
            <select name="search_by" id="search_by">
                <option value="User" [[= 'selected' if search_by == 'user' else '' ]]>User</option>
                <option value="Role" [[= 'selected' if search_by == 'role' else '' ]]>Role</option>
                <option value="BranchCode" [[= 'selected' if search_by == 'branch_code' else '' ]]>Branch Code</option>
                <option value="BranchName" [[= 'selected' if search_by == 'branch_name' else '' ]]>Branch Name</option>
                <option value="Mobile" [[= 'selected' if search_by == 'mobile' else '' ]]>Mobile</option>
            </select> 
            <label for="search_term">Search Term:</label>
            <input type="text" name="search_term" id="search_term" value="[[=search_term]]">
            <button type="submit" class="btn btn-sm btn-primary me-2" data-toggle="tooltip" data-placement="bottom" title="Search">Search</button>
            <a href="[[=URL('users','users')]]" class="btn btn-sm btn-secondary" data-toggle="tooltip" data-placement="bottom" title="Clear Search">Clear</a>
        </form>
    </div> 
    
    


    <div class="container py-4">
        <div class="container py-0">
            <p>Showing [[=start_record]] to [[=end_record]] of [[=total_records]] records</p>   
        </div>
        <div class="row">
        <div class="col-9">
            
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">User Name</th>
                        <th scope="col">First Name</th> 
                        <th scope="col">Last Name</th> 
                        <th scope="col">Email</th> 
                        <th scope="col">Mobile #</th> 
                        <th scope="col">Branch</th>
                        <th scope="col">Role</th>                        
                        <th scope="col">Action</th>                                  
                    </tr>
                </thead>
                <tbody>
                    [[for row in user_rows:]]
                    <tr>
                        <td>[[=row['username']]]</td>
                        <td>[[=row['first_name']]]</td>
                        <td>[[=row['last_name']]]</td>
                        <td>[[=row['email']]]</td>
                        <td>[[=row['contact']]]</td>
                        <td>[[=row['branch_name']]]</td>
                        <td>[[=row['role']]]</td>                      
                        
                        
                        <td>
                            <a class="button" href="[[=URL('users','edit_user', row['id'])]]">
                                <i class="fa-regular fa-pen-to-square"></i>
                            </a>
                        </td> 
                                              
                    </tr>
                    [[pass]]
                </tbody>
            </table>
            <!-- Pagination Controls -->
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    [[if page > 1:]]
                    <li class="page-item">
                        <a class="page-link" href="[[=URL('users','users', vars=dict(page=page-1, search_term=search_term, search_by=search_by))]]" aria-label="Previous">
                            <span aria-hidden="true">Â«</span>
                        </a>
                    </li>
                    [[pass]]
            
                    [[if page > 6:]]
                    <li class="page-item">
                        <a class="page-link" href="[[=URL('users','users', vars=dict(page=1, search_term=search_term, search_by=search_by))]]">1</a>
                    </li>
                    <li class="page-item disabled"><span class="page-link">...</span></li>
                    [[pass]]
            
                    [[for p in range(max(1, page-5), min(total_pages+1, page+5)):]]
                    <li class="page-item [[= 'active' if p == page else '']]">
                        <a class="page-link" href="[[=URL('users','users', vars=dict(page=p, search_term=search_term, search_by=search_by))]]">[[=p]]</a>
                    </li>
                    [[pass]]
            
                    [[if page < total_pages - 5:]]
                    <li class="page-item disabled"><span class="page-link">...</span></li>
                    <li class="page-item">
                        <a class="page-link" href="[[=URL('users','users', vars=dict(page=total_pages, search_term=search_term, search_by=search_by))]]">[[=total_pages]]</a>
                    </li>
                    [[pass]]
            
                    [[if page < total_pages:]]
                    <li class="page-item">
                        <a class="page-link" href="[[=URL('users','users', vars=dict(page=page+1, search_term=search_term, search_by=search_by))]]" aria-label="Next">
                            <span aria-hidden="true">Â»</span>
                        </a>
                    </li>
                    [[pass]]
                </ul>
            </nav>
                
           
        </div>
    </div>

    </div>
    
</div>
[[end]]

[[block scripts]]
<script>
  $(document).ready(function() {
            $('#ac_auth_user_username').on('input', function() {
                this.value = this.value.toUpperCase();
            });

            $("#ac_auth_user_branch_name").change(function() {  
                // console.log('Hello')  ;
                var selectedValue = $(this).val();  
                $.ajax({
                    url: '[[=URL("get_branch_code")]]', // Replace with your endpoint
                    method: 'GET',
                    data: { q: selectedValue },
                    dataType: 'json',
                    success: function(data) {
                    // console.log(data['branh_code'])            
                    $("#ac_auth_user_branch_code").val(data['branch_code']);            
                }
            });  

        })
});

    

    
</script>

[[end]]
