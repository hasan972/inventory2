[[extend 'layout3.html']]

[[block header]]

[[icon='fa fa-chart-line']]
[[breadcamp = 'Reports']]
<style>
    .form-container {
        max-width: 600px;
        margin: auto;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #f9f9f9;
    }
    .form-group {
        margin-bottom: 15px;
    }
    .btn-group {
        display: flex;
        flex-direction: column;
    }
    .btn-group button {
        margin-bottom: 10px;
    }

    li{
        list-style: none;
        cursor: pointer;
    }
    ul.suggestion-list-sp {
        list-style-type: none;
        margin: 0;
        padding: 0;
        
        }


    .suggestions-sp {
        display: block; 
        background: #eee;
        position: absolute;               
        z-index: 1000; 
        
        
    }
    ul.suggestion-list-itm {
        list-style-type: none;
        margin: 0;
        padding: 0;
        
    }

    .suggestions-itm {
        display: block; 
        background: #eee;
        position: absolute;               
        z-index: 1000;        
    }

    ul.suggestion-list-br {
        list-style-type: none;
        margin: 0;
        padding: 0;
        
    }

    .suggestions-br {
        display: block; 
        background: #eee;
        position: absolute;               
        z-index: 1000;        
    }
     
    .report-btn {
        width: 220px; /* Set a fixed width for all buttons */
        text-align: center; /* Center align text */
        white-space: nowrap; /* Prevent text wrapping */
    }
    td {
        white-space: nowrap;

    }

</style>
[[end]]

[[block content]]
<br>

<div class="container py-4">
    <form id="reports-form" method="post" target="_blank">
        <div class="row justify-content-center">
            <div class="col-md-4">
                <div class="mb-3">                    
                    <div class="table-responsive">
                        <table id="example" class="table table-sm table-borderless" style="width:100%">                        
                            <tbody>
                                <tr>
                                    <td>
                                        <label for="from_date">From Date</label>            
                                    </td>
                                    <td>                                    
                                        <input type="date" class="form-control form-control-sm" id="from_date" name="from_date" required>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="to_date">To Date</label>                                   
                                    </td>
                                    <td>                                 
                                        <input type="date" class="form-control form-control-sm" id="to_date" name="to_date" required>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="branch">Branch</label>                               
                                    </td>
                                    <td>                                 
                                        <select class="form-control form-control-sm" id="branch" name="branch" required>
                                            [[if user_branch_code != 99:]]
                                            <option value="[[=branch_diabled]]">[[=branch_diabled]]</option>
                                            [[else:]]
                                            <option value="">Select Branch</option>
                                            [[for branch in branch_names:]]
                                            <option value="[[=branch[0]]]">[[=branch[0]]]</option>
                                            [[pass]]
                                            [[pass]]
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="supplier">Supplier</label>                             
                                    </td>
                                    <td>
                                        <input type="text" class="form-control form-control-sm" id="supplier" name="supplier" autocomplete="off">
                                        <div class="suggestions-sp mt-2">
                                            <ul class="suggestion-list-sp list-group" id="dropdata-sp">
                                                <!-- suggestions will be displayed here -->
                                            </ul>
                                        </div>                                                                        
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        <label for="brand">Brand</label>                             
                                    </td>
                                    <td>
                                        <input type="text" class="form-control form-control-sm" id="brand" name="brand" autocomplete="off">
                                        <div class="suggestions-br mt-2">
                                            <ul class="suggestion-list-br list-group" id="dropdata-br">
                                                <!-- suggestions will be displayed here -->
                                            </ul>
                                        </div>
                                        <!-- <input type="hidden" class="form-control form-control-sm" id="seg" name="seg" >                                 -->
                                    </td>
                                </tr>                                
                                <tr>
                                    <td>
                                        <label for="item">Item</label>                   
                                    </td>
                                    <td>
                                        <input type="text" class="form-control form-control-sm" id="item" name="item" autocomplete="off">
                                        <div class="suggestions-itm mt-2">
                                            <ul class="suggestion-list-rf list-group" id="dropdata-itm">
                                                <!-- suggestions will be displayed here -->
                                            </ul>
                                        </div>                                
                                    </td>
                                </tr>                                
                            </tbody>
                            
                        </table>                    
                    </div>              
                    
                </div>
            </div>
            <div class="col-md-5">
                <div class="mb-3">                    
                    <div class="table-responsive">
                        <table id="example" class="table table-sm table-borderless" style="width:100%">                            
                            <tbody>                                
                                <tr>
                                    <td>
                                        <button type="button" class="btn btn-primary report-btn" id="report1-btn">Item Stock</button>
                                    </td>                                    
                                </tr>
                                <tr>
                                    <td>
                                        <button type="button" class="btn btn-primary report-btn" id="report2-btn">Item History</button>
                                    </td>                                    
                                </tr>
                                <tr>
                                    <td>
                                        <button type="button" class="btn btn-primary report-btn" id="report3-btn">Sales Details</button>
                                    </td>                                    
                                </tr>
                                
                                
                            </tbody>
                            

                        </table>
                        
                    </div>  
                    
                </div>
            </div>

        </div>  
    </form>    

</div>


[[end]]


[[block scripts]]
<script>
    $(document).ready(function() {
        function validateDateRange() {
            // Get the dates from the input fields
            const fromDate = new Date($('#from_date').val());
            const toDate = new Date($('#to_date').val());

            // Check if the to_date is earlier than the from_date
            if (toDate < fromDate) {
                // alert("To Date cannot be earlier than From Date.");
                Swal.fire({
                        title: "Invalid Date Range",
                        text: "To Date cannot be earlier than From Date.",
                        icon: "error"
                    });
                return false; // Prevent form submission
            }

            // Calculate the difference in days
            const timeDifference = toDate - fromDate;
            const dayDifference = timeDifference / (1000 * 60 * 60 * 24);

            // Check if the difference exceeds 31 days
            if (dayDifference > 31) {
                // alert("The interval between From Date and To Date should not be more than 31 days.");
                Swal.fire({
                        title: "Invalid Date Range",
                        text: "The interval between From Date and To Date should not be more than 31 days.",
                        icon: "error"
                    });
                return false; // Prevent form submission
            }
            return true; // Allow form submission
        }
       
        // item stock 
        $("#report1-btn").click(function() {
            var branch = $('#branch').val()
            if($("#from_date").val() == "") {
                Swal.fire({
                        title: "Invalid Date",
                        text: "Please select from date",
                        icon: "error"
                    }); 
            }            
            else if ($("#to_date").val() == "") {
                Swal.fire({
                        title: "Invalid Date",
                        text: "Please select to date",
                        icon: "error"
                    }); 
            }
            else if(!validateDateRange()) {
                return;
            }
            else if(branch == 'Select Branch' || branch=='') {
                // alert("Please select branch");
                Swal.fire({
                        title: "Invalid Branch",
                        text: "Please select branch",
                        icon: "error"
                    }); 
            }
            else {
                $("#reports-form").attr("action", "[[=URL('reports','item_stock')]]");
                $("#reports-form").submit();
            }
            
        });

        // item history
        $("#report2-btn").click(function() {
            var branch = $('#branch').val()
            var item = $('#item').val()
            if($("#from_date").val() == "") {
                Swal.fire({
                        title: "Invalid Date",
                        text: "Please select from date",
                        icon: "error"
                    }); 
            }            
            else if ($("#to_date").val() == "") {
                Swal.fire({
                        title: "Invalid Date",
                        text: "Please select to date",
                        icon: "error"
                    }); 
            }
            else if(!validateDateRange()) {
                return;
            }
            else if(branch == 'Select Branch' || branch=='') {
                // alert("Please select branch");
                Swal.fire({
                        title: "Invalid Branch",
                        text: "Please select branch",
                        icon: "error"
                    }); 
            }
            else if(item=='') {
                // alert("Please select branch");
                Swal.fire({
                        title: "Invalid item",
                        text: "Please select item",
                        icon: "error"
                    }); 
            }
            else {
                $("#reports-form").attr("action", "[[=URL('reports','item_history')]]");
                $("#reports-form").submit();
            }
            
        });

        // autofill suggestion for supplier
        $('#supplier').on('input', function() {       
            // console.log("Hello") 
            var query = $(this).val(); 
            // console.log(parts[0]);               
            if (query.length >= 3) {
                $.ajax({
                    url: '[[=URL("reports","fetch_supplier")]]',
                    data: {term: query},
                    success: function(data) {
                        var suggestions = JSON.parse(data);
                        var dropdown = $('#dropdata-sp');
                        dropdown.empty(); 
                        $.each(suggestions, function(index, value) {
                            dropdown.append('<li class="list-group-item suggestion-item-sp">' + value + '</li>');
                        });
                        $('.suggestions-sp').show();
                    }
                });
            } else {
                $('.suggestions-sp').hide(); 
        }
    });

    //click on a suggestion
    $(document).on('click', '.suggestion-item-sp', function() {
        var selectedText = $(this).text();
        var parts = selectedText.split('|');        
        $('#supplier').val(selectedText);         
        $('.suggestions-sp').hide();
        
    });
    // click outside
    $(document).click(function(e) {
        if (!$(e.target).closest('.suggestions-sp, #supplier').length) {
            $('.suggestions-sp').hide();
        }
    });

        // autofill suggestion for brand
        $('#brand').on('input', function() {       
            // console.log("Hello") 
            var query = $(this).val(); 

            // console.log(parts[0]);               
            if (query.length >= 3) {
                $.ajax({
                    url: '[[=URL("reports","fetch_brand")]]',
                    data: {term: query},
                    success: function(data) {
                        var suggestions = JSON.parse(data);
                        var dropdown = $('#dropdata-br');
                        dropdown.empty(); 
                        $.each(suggestions, function(index, value) {
                            dropdown.append('<li class="list-group-item suggestion-item-br">' + value + '</li>');
                        });
                        $('.suggestions-br').show();
                    }
                });
            } else {
                $('.suggestions-br').hide(); 
        }
    });

    //click on a suggestion
    $(document).on('click', '.suggestion-item-br', function() {
        var selectedText = $(this).text();
        var parts = selectedText.split('|');        
        $('#brand').val(selectedText);         
        $('.suggestions-br').hide();
        
    });
    // click outside
    $(document).click(function(e) {
        if (!$(e.target).closest('.suggestions-br, #brand').length) {
            $('.suggestions-br').hide();
        }
    });


        // autofill suggestion for brand
        $('#item').on('input', function() {       
            // console.log("Hello") 
            var query = $(this).val(); 

            // console.log(parts[0]);               
            if (query.length >= 3) {
                $.ajax({
                    url: '[[=URL("receive","fetch_item_code_name")]]',
                    data: {term: query},
                    success: function(data) {
                        var suggestions = JSON.parse(data);
                        var dropdown = $('#dropdata-itm');
                        dropdown.empty(); 
                        $.each(suggestions, function(index, value) {
                            dropdown.append('<li class="list-group-item suggestion-item-itm">' + value + '</li>');
                        });
                        $('.suggestions-itm').show();
                    }
                });
            } else {
                $('.suggestions-itm').hide(); 
        }
    });

    //click on a suggestion
    $(document).on('click', '.suggestion-item-itm', function() {
        var selectedText = $(this).text();
        var parts = selectedText.split('|');        
        $('#item').val(selectedText);         
        $('.suggestions-itm').hide();
        
    });
    // click outside
    $(document).click(function(e) {
        if (!$(e.target).closest('.suggestions-br, #brand').length) {
            $('.suggestions-br').hide();
        }
    });
        

    

});
    </script>
[[end]]


